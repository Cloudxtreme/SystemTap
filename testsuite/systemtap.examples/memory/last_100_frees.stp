#! /usr/bin/env stap 

global bt%[100]
global idx

probe process("/lib*/libc.so.*").function("free") {
  bt[execname(),tid(),$mem,sprint_ubacktrace()] <<< idx++
}

probe end,error {
  foreach ([e,t,p,b] in bt @max+) // iterate in increasing index order
     printf("free #%d: %s[%d], pointer %p:\n%s\n\n",
            @max(bt[e,t,p,b]), e, t, p, b)
}
