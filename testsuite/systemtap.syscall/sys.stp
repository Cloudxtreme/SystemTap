global indent, indent_str, entry

probe begin {
	indent = 0
	for (i=0; i<20; i++) {
		if (i == 0)
			indent_str[0] = ""
		else
			indent_str[i] =  indent_str[i-1] . "  "
	}
}


probe syscall.* ? {
	if (pid() == target()) {
		if (entry) printf("\n")
		printf("%s%s: %s (%s) = ", indent_str[indent], execname(), name, argstr)
#		printf("%s%s: %s (%s) = ", indent_str[indent], execname(), probefunc(), argstr)
		indent++
		entry = 1
	}
}

probe syscall.*.return ? {
	if (pid() == target()) {
		if (indent) indent--
		if (entry)
			printf("%s\n", retstr)
		else
			printf("%s%s\n", indent_str[indent],retstr)
		entry = 0
	}
}

probe end {
	printf("\n")
}
