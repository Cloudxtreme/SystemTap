Description: grapher libraries as needed
Author: Євгеній Мещеряков <eugen@debian.org>
Applied-Upstream: http://sources.redhat.com/git/gitweb.cgi?p=systemtap.git;a=commit;h=e025bf5794ee006e0030b0974183a02ef1beedaa
--- a/grapher/Makefile.am
+++ b/grapher/Makefile.am
@@ -9,5 +9,6 @@
 stapgraph_CXXFLAGS = $(libglade_CFLAGS) -Wall -Werror
 stapgraph_SOURCES = grapher.cxx StapParser.cxx Graph.cxx GraphWidget.cxx CairoWidget.cxx GraphStyle.cxx
 stapgraph_LDADD = $(libglade_LIBS)
+stapgraph_LDFLAGS = -Wl,--as-needed
 dist_pkgdata_DATA = graph-dialog.glade stap-start.glade processwindow.glade
 endif
--- a/grapher/Makefile.in
+++ b/grapher/Makefile.in
@@ -65,7 +65,7 @@
 am__DEPENDENCIES_1 =
 @BUILD_GRAPHER_TRUE@stapgraph_DEPENDENCIES = $(am__DEPENDENCIES_1)
 stapgraph_LINK = $(CXXLD) $(stapgraph_CXXFLAGS) $(CXXFLAGS) \
-	$(AM_LDFLAGS) $(LDFLAGS) -o $@
+	$(stapgraph_LDFLAGS) $(LDFLAGS) -o $@
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -278,6 +278,7 @@
 @BUILD_GRAPHER_TRUE@stapgraph_CXXFLAGS = $(libglade_CFLAGS) -Wall -Werror
 @BUILD_GRAPHER_TRUE@stapgraph_SOURCES = grapher.cxx StapParser.cxx Graph.cxx GraphWidget.cxx CairoWidget.cxx GraphStyle.cxx
 @BUILD_GRAPHER_TRUE@stapgraph_LDADD = $(libglade_LIBS)
+@BUILD_GRAPHER_TRUE@stapgraph_LDFLAGS = -Wl,--as-needed
 @BUILD_GRAPHER_TRUE@dist_pkgdata_DATA = graph-dialog.glade stap-start.glade processwindow.glade
 all: all-am
 
